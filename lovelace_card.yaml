# ============================================
# CARTE LOVELACE - GESTIONNAIRE CONG√âLATEUR
# ============================================
# √Ä copier dans votre Dashboard -> Modifier -> + Ajouter une carte -> Manuel

type: vertical-stack
cards:
  # --- EN-T√äTE AVEC STATISTIQUES ---
  - type: horizontal-stack
    cards:
      - type: entity
        entity: sensor.gestionnaire_d_inventaire_congelateur
        name: "Cong√©lateur"
        icon: mdi:fridge-industrial-outline
      - type: entity
        entity: sensor.gestionnaire_d_inventaire_produits_perimant_bientot
        name: "Bient√¥t p√©rim√©s"
        icon: mdi:clock-alert
      - type: entity
        entity: sensor.gestionnaire_d_inventaire_produits_perimes
        name: "P√©rim√©s"
        icon: mdi:alert-circle

  # --- LISTE DES PRODUITS ---
  - type: markdown
    title: "üßä Contenu du cong√©lateur"
    content: |
      {% set products = state_attr('sensor.gestionnaire_d_inventaire_congelateur', 'products') %}
      {% if products and products | length > 0 %}
      | Produit | P√©remption | Statut | Qt√© |
      |:--------|:-----------|:------:|:---:|
      {% for p in products %}
      | {{ p.name[:30] }} | {{ p.expiry_date }} | {% if p.days_until_expiry < 0 %}üî¥{% elif p.days_until_expiry <= 3 %}üü†{% elif p.days_until_expiry <= 7 %}üü°{% else %}üü¢{% endif %} {{ p.days_until_expiry }}j | {{ p.quantity }} |
      {% endfor %}
      {% else %}
      *Aucun produit dans le cong√©lateur* üéâ
      {% endif %}

  # --- BOUTONS D'ACTION ---
  - type: horizontal-stack
    cards:
      - type: button
        name: "Ajouter manuellement"
        icon: mdi:plus-circle
        icon_height: 40px
        tap_action:
          action: navigate
          navigation_path: /config/script/edit/new
        hold_action:
          action: call-service
          service: script.ajouter_produit_congelateur

      - type: button
        name: "Scanner code-barres"
        icon: mdi:barcode-scan
        icon_height: 40px
        tap_action:
          action: call-service
          service: script.scanner_produit_congelateur

  # --- ALERTES P√âREMPTION ---
  - type: conditional
    conditions:
      - condition: numeric_state
        entity: sensor.gestionnaire_d_inventaire_produits_perimant_bientot
        above: 0
    card:
      type: markdown
      title: "‚ö†Ô∏è √Ä consommer rapidement"
      content: |
        {% set products = state_attr('sensor.gestionnaire_d_inventaire_produits_perimant_bientot', 'products') %}
        {% for p in products %}
        - **{{ p.name }}** ‚Üí {{ p.expiry_date }} ({{ p.days_until_expiry }}j)
        {% endfor %}

  # --- ALERTE PRODUITS P√âRIM√âS ---
  - type: conditional
    conditions:
      - condition: numeric_state
        entity: sensor.gestionnaire_d_inventaire_produits_perimes
        above: 0
    card:
      type: markdown
      title: "üö® PRODUITS P√âRIM√âS"
      content: |
        {% set products = state_attr('sensor.gestionnaire_d_inventaire_produits_perimes', 'products') %}
        {% for p in products %}
        - ~~{{ p.name }}~~ - P√©rim√© depuis {{ p.days_expired }}j
        {% endfor %}
