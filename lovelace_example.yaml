# Exemple de carte Lovelace pour Inventory Manager
# √Ä ajouter dans votre dashboard Lovelace

# ===== CARTE PRINCIPALE - CONG√âLATEUR =====
type: vertical-stack
cards:
  # En-t√™te avec statistiques
  - type: horizontal-stack
    cards:
      - type: entity
        entity: sensor.gestionnaire_d_inventaire_congelateur
        name: "Cong√©lateur"
        icon: mdi:fridge-industrial-outline
      - type: entity
        entity: sensor.gestionnaire_d_inventaire_produits_perimant_bientot
        name: "Expire bient√¥t"
        icon: mdi:clock-alert
      - type: entity
        entity: sensor.gestionnaire_d_inventaire_produits_perimes
        name: "P√©rim√©s"
        icon: mdi:alert-circle

  # Liste des produits du cong√©lateur
  - type: markdown
    title: "üì¶ Produits dans le cong√©lateur"
    content: >
      {% set products = state_attr('sensor.gestionnaire_d_inventaire_congelateur', 'products') %}
      {% if products and products | length > 0 %}
      | Produit | Date exp. | Jours | Qt√© |
      |---------|-----------|-------|-----|
      {% for p in products %}
      | {{ p.name[:25] }} | {{ p.expiry_date }} | {% if p.days_until_expiry < 0 %}üî¥ {{ p.days_until_expiry | abs }}j{% elif p.days_until_expiry <= 3 %}üü† {{ p.days_until_expiry }}j{% elif p.days_until_expiry <= 7 %}üü° {{ p.days_until_expiry }}j{% else %}üü¢ {{ p.days_until_expiry }}j{% endif %} | {{ p.quantity }} |
      {% endfor %}
      {% else %}
      *Aucun produit dans le cong√©lateur*
      {% endif %}

  # Boutons d'action rapide
  - type: horizontal-stack
    cards:
      - type: button
        name: "Ajouter produit"
        icon: mdi:plus-circle
        tap_action:
          action: call-service
          service: browser_mod.popup
          service_data:
            title: "Ajouter un produit"
            content:
              type: custom:config-template-card
              entities: []
              card:
                type: entities
                entities:
                  - type: custom:text-input-row
                    entity: input_text.product_name
                    name: Nom
                  - type: custom:text-input-row
                    entity: input_datetime.product_expiry
                    name: Date exp.
      
      - type: button
        name: "Scanner"
        icon: mdi:barcode-scan
        tap_action:
          action: call-service
          service: notify.mobile_app_votre_telephone
          service_data:
            message: "command_barcode_scanner"

# ===== CARTE DES PRODUITS EXPIRANT BIENT√îT =====
  - type: conditional
    conditions:
      - entity: sensor.gestionnaire_d_inventaire_produits_perimant_bientot
        state_not: "0"
    card:
      type: markdown
      title: "‚ö†Ô∏è Produits √† consommer rapidement"
      content: >
        {% set products = state_attr('sensor.gestionnaire_d_inventaire_produits_perimant_bientot', 'products') %}
        {% for p in products %}
        - **{{ p.name }}** - Expire le {{ p.expiry_date }} ({{ p.days_until_expiry }} jour{% if p.days_until_expiry > 1 %}s{% endif %})
        {% endfor %}

# ===== SCRIPT POUR SUPPRIMER UN PRODUIT (√† ajouter dans scripts.yaml) =====
# remove_product_quick:
#   alias: "Supprimer produit rapidement"
#   fields:
#     product_id:
#       description: "ID du produit"
#   sequence:
#     - service: inventory_manager.remove_product
#       data:
#         product_id: "{{ product_id }}"

# ===== CARTE AVEC SUPPRESSION RAPIDE (n√©cessite auto-entities) =====
# type: custom:auto-entities
# card:
#   type: entities
#   title: "üóëÔ∏è Supprimer un produit"
# filter:
#   template: |
#     {% set products = state_attr('sensor.gestionnaire_d_inventaire_congelateur', 'products') %}
#     {% for p in products %}
#     {{
#       {
#         'type': 'button',
#         'name': p.name,
#         'icon': 'mdi:delete',
#         'tap_action': {
#           'action': 'call-service',
#           'service': 'inventory_manager.remove_product',
#           'service_data': {'product_id': p.id}
#         }
#       }
#     }},
#     {% endfor %}
